# 🎬 t_series 表烧制视频字段更新

## 📋 更新概述

为支持未来的视频字幕烧制功能，在 `t_series` 表中新增了两个字段来存储烧制后的视频信息。

## 🆕 新增字段

### 1. `new_name` (TEXT)
- **用途**: 存储烧制后的新视频名称
- **示例**: `"output_with_subtitles.mp4"`
- **可为空**: 是（默认 NULL）

### 2. `new_file_path` (TEXT)
- **用途**: 存储烧制后的新视频文件完整路径
- **示例**: `"/path/to/outputs/video_with_subtitles.mp4"`
- **可为空**: 是（默认 NULL）

## 🛠️ 技术实现

### 数据库迁移
- ✅ **自动迁移**: 系统启动时自动检测并添加新字段
- ✅ **向后兼容**: 现有数据不受影响
- ✅ **安全操作**: 使用 `ALTER TABLE` 语句安全添加字段

### 数据库结构更新后
```sql
CREATE TABLE t_series (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    name TEXT NOT NULL,
    file_path TEXT,
    file_type TEXT,
    duration REAL,
    new_name TEXT,              -- 新增字段
    new_file_path TEXT,         -- 新增字段
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP
);
```

## 🔧 API 功能增强

### 1. 创建系列 (扩展)
```python
def create_series(name, file_path=None, file_type=None, duration=None, 
                 new_name=None, new_file_path=None):
    # 支持在创建时直接设置烧制视频信息
```

### 2. 更新烧制视频信息 (新增)
```python
def update_series_video_info(series_id, new_name=None, new_file_path=None):
    # 专门用于更新烧制视频信息
    # 支持部分更新（只更新提供的字段）
```

## 🎨 界面功能更新

### 媒体系列管理界面
- ✅ **扩展表格**: 新增"烧制视频名"和"烧制路径"列
- ✅ **信息更新**: 新增烧制视频信息更新功能区域
- ✅ **用户友好**: 路径过长时自动截断显示
- ✅ **状态指示**: 未设置时显示"未烧制"/"未设置"

### 新增功能区域
```
🎬 更新烧制视频信息
├── 系列ID输入框
├── 烧制视频名称输入框
├── 烧制视频路径输入框
├── 💾 更新信息按钮
└── 更新结果显示
```

## 📊 数据显示优化

### 系列列表表格
| ID | 名称 | 文件类型 | 时长(秒) | 烧制视频名 | 烧制路径 | 创建时间 |
|----|------|----------|----------|------------|----------|----------|
| 3  | 1.mp4 | video   | 120.5    | output.mp4 | /path... | 2024-... |

### 状态显示逻辑
- **烧制视频名**: 
  - 有值：显示实际名称
  - 无值：显示"未烧制"
- **烧制路径**: 
  - 有值：显示路径（长路径自动截断）
  - 无值：显示"未设置"

## 🧪 测试验证

### 测试覆盖
- ✅ **数据库迁移**: 自动添加字段
- ✅ **字段创建**: 新字段正确存在
- ✅ **数据更新**: 完整更新和部分更新
- ✅ **数据查询**: 新字段数据正确获取
- ✅ **界面显示**: 新字段正确显示

### 测试结果
```
=== 测试 t_series 表新增字段功能 ===
✅ 数据库模块导入成功
✅ 更新成功
✅ 部分更新成功
✅ 新字段 new_name 和 new_file_path 存在
✅ 系列视频字段功能测试完成！
```

## 💡 使用场景

### 典型工作流程
1. **原始处理**: 用户上传视频 → 生成字幕 → 保存到数据库
2. **字幕烧制**: 使用字幕数据 → 生成带字幕的新视频
3. **信息记录**: 更新 `new_name` 和 `new_file_path` 字段
4. **文件管理**: 通过数据库管理界面查看和管理烧制后的视频

### 实际应用
- **批量处理**: 处理多个视频文件，记录每个的烧制结果
- **文件跟踪**: 轻松找到对应的烧制后视频文件
- **状态管理**: 区分已烧制和未烧制的视频
- **路径管理**: 统一管理原始和烧制后的文件位置

## 🔮 未来扩展

### 计划功能
- [ ] **一键烧制**: 直接从数据库界面启动字幕烧制
- [ ] **批量烧制**: 选择多个系列进行批量烧制
- [ ] **进度跟踪**: 实时显示烧制进度
- [ ] **质量设置**: 支持不同的烧制质量和格式选项
- [ ] **预览功能**: 烧制前预览字幕效果
- [ ] **自动清理**: 自动清理临时文件和过期文件

### 数据库优化
- [ ] **索引优化**: 为新字段添加合适的索引
- [ ] **统计增强**: 在统计信息中包含烧制状态
- [ ] **关联查询**: 支持更复杂的多表关联查询

## 📁 相关文件

### 核心文件
- `src/database.py` - 数据库管理和迁移逻辑
- `src/database_interface.py` - 管理界面更新
- `test/test_series_video_fields.py` - 功能测试脚本

### 文档文件
- `VIDEO_BURNING_FIELDS_UPDATE.md` - 本文档
- `DATABASE_README.md` - 数据库整体文档
- `AI_KEYWORD_EXTRACTION_GUIDE.md` - AI关键词提取指南

---

**🎬 烧制视频字段为EnglishCut的视频处理能力奠定了基础！** 