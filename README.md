# 🎵 EnglishCut - 音频转文字 & LRC字幕生成器

一个基于 OpenAI Whisper 和 GPT-4o 的智能音频转文字工具，支持生成英中双语 LRC 字幕文件。

## ✨ 特色功能

- 🚀 **Mac M4 GPU 加速** - 自动检测并使用 MPS 加速
- 🎯 **高精度识别** - 基于 OpenAI Whisper 模型
- 🌏 **双语字幕** - 使用 GPT-4o 生成高质量中文翻译
- 📄 **LRC 格式** - 标准时间戳字幕文件
- 🖥️ **Web 界面** - 基于 Gradio 的友好界面
- ⚡ **实时监控** - 处理进度和性能统计
- 🔧 **简化配置** - 使用 python-dotenv 管理环境变量

## 🛠️ 安装说明

### 1. 环境要求

- Python 3.8+
- macOS (推荐 M1/M2/M3/M4 芯片)
- FFmpeg

### 2. 安装 FFmpeg

```bash
# 使用 Homebrew 安装
brew install ffmpeg
```

### 3. 安装 Python 依赖

```bash
# 激活 conda 环境
conda activate englishcut

# 安装依赖
pip install -r requirements.txt
```

包含的主要依赖：
- `transformers` - Hugging Face 模型库
- `openai` - OpenAI API 客户端
- `python-dotenv` - 环境变量管理
- `gradio` - Web 界面框架
- `torch` - PyTorch 深度学习框架

## 🔑 配置 OpenAI API

### 方法1：复制配置文件

```bash
# 复制示例配置文件
cp env.example .env

# 编辑配置文件
nano .env
```

### 方法2：直接创建 .env 文件

```bash
echo "OPENAI_API_KEY=sk-your-actual-api-key-here" > .env
```

**注意**: 
- 需要有效的 OpenAI API 密钥才能使用双语翻译功能
- 获取 API 密钥: https://platform.openai.com/api-keys

## 🚀 使用方法

### 1. 启动应用

```bash
conda activate englishcut
python src/gradio_server.py
```

### 2. 打开浏览器

访问：http://127.0.0.1:7860

### 3. 操作步骤

1. **上传音频文件** - 支持 WAV、FLAC、MP3 格式
2. **选择字幕模式** - 勾选"🌏 生成英中双语字幕"
3. **开始识别** - 点击"🚀 开始识别"按钮
4. **查看结果** - 等待处理完成
5. **下载字幕** - 点击下载 LRC 文件

## 📁 输出格式

### 英中双语 LRC 示例

```lrc
[ti:Audio Transcription]
[ar:Generated by EnglishCut]
[al:your-audio-file]
[by:OpenAI Whisper]
[offset:0]

[00:00.00]Can you give me a ride to school? // 你能送我一程去学校吗？
[00:02.00]I can't, because I have to finish a report. // 我不能，因为我必须完成一份报告。
[00:05.00]Well, how long is it going to take you? // 嗯，这会花你多长时间？
```

## ⚡ 性能优化

### Mac M4 优化配置

- **设备**: 自动检测 MPS (Metal Performance Shaders)
- **模型**: `whisper-base` (速度优化)
- **批次大小**: 8 (M4 优化)
- **预期速度**: 5-10倍实时速度

### 处理时间参考

| 音频长度 | Mac M4 (MPS) | CPU |
|---------|-------------|-----|
| 5分钟   | 30-60秒     | 3-5分钟 |
| 11分钟  | 1-2分钟     | 8-15分钟 |
| 30分钟  | 3-5分钟     | 20-40分钟 |

## 📂 项目结构

```
EnglishCut/
├── src/
│   ├── gradio_server.py    # Web 界面
│   ├── openai_whisper.py   # 音频处理和翻译
│   └── logger.py           # 日志配置
├── requirements.txt        # Python 依赖
├── env.example            # 环境变量示例
├── .env                   # 环境变量配置 (需要创建)
└── README.md              # 项目说明
```


## 🐛 常见问题

### Q: 双语翻译不工作？
A: 检查 `.env` 文件中的 `OPENAI_API_KEY` 是否正确设置

### Q: 处理速度很慢？
A: 确保在 Mac 上启用了 MPS 加速，查看日志中的设备信息

### Q: 音频格式不支持？
A: 使用 FFmpeg 将音频转换为 WAV/FLAC/MP3 格式

### Q: 内存不足？
A: 关闭双语模式或使用更小的音频文件

## 🔄 更新日志

- **v2.0** - 添加 GPT-4o 双语翻译功能
- **v1.5** - Mac M4 GPU 加速优化
- **v1.0** - 基础音频转文字功能

## 📄 许可证

MIT License - 详见 LICENSE 文件

## 🤝 贡献

欢迎提交 Issue 和 Pull Request！

---

**享受高质量的音频转文字体验！** 🎉
