# 📊 EnglishCut 数据库功能说明

## 🎯 功能概述

EnglishCut 现已集成本地 SQLite 数据库，实现媒体文件、字幕和重点单词的持久化管理。

## 📋 数据库设计

### 🎬 媒体系列表 (t_series)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键，自增序列 |
| name | TEXT | 文件名称 |
| file_path | TEXT | 文件路径 |
| file_type | TEXT | 文件类型 (audio/video) |
| duration | REAL | 时长（秒） |
| created_at | TIMESTAMP | 创建时间 |
| updated_at | TIMESTAMP | 更新时间 |

### 📝 字幕表 (t_subtitle)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键，自增序列 |
| series_id | INTEGER | 外键，关联媒体系列 |
| begin_time | REAL | 开始时间（秒） |
| end_time | REAL | 结束时间（秒） |
| english_text | TEXT | 英文文本 |
| chinese_text | TEXT | 中文文本 |
| created_at | TIMESTAMP | 创建时间 |

### 📚 关键词表 (t_keywords)
| 字段 | 类型 | 说明 |
|------|------|------|
| id | INTEGER | 主键，自增序列 |
| subtitle_id | INTEGER | 外键，关联字幕 |
| key_word | TEXT | 关键词 |
| phonetic_symbol | TEXT | 音标 |
| explain_text | TEXT | 解释 |
| created_at | TIMESTAMP | 创建时间 |

## 🚀 使用方法

### 1. 启动服务
```bash
# 启动所有服务（推荐）
conda activate englishcut
python start_services.py

# 或分别启动
python src/gradio_server.py      # 主界面 (端口 7860)
python src/database_interface.py # 数据库管理 (端口 7861)
```

### 2. 处理媒体文件
1. 访问主界面: http://localhost:7860
2. 上传音频/视频文件
3. 选择字幕格式和选项
4. 点击"开始处理"
5. **数据自动保存到数据库** ✨

### 3. 管理数据库
1. 访问数据库管理界面: http://localhost:7861
2. 查看统计信息和媒体列表
3. 浏览字幕内容
4. 搜索和管理关键词
5. 手动添加重点单词

## 📈 主要功能

### 🔍 数据查询
- **媒体系列管理**: 查看所有已处理的音视频文件
- **字幕浏览**: 按系列查看详细字幕内容
- **关键词检索**: 快速搜索重点单词
- **统计信息**: 查看数据库整体统计

### 📚 词汇管理
- **自动提取**: 处理字幕时自动识别重点词汇（待实现）
- **手动添加**: 支持手动添加单词、音标和解释
- **跨文件搜索**: 在所有媒体中搜索特定单词
- **学习追踪**: 为英语学习提供词汇库

### 🗄️ 数据持久化
- **自动保存**: 处理完成后自动保存到数据库
- **级联删除**: 删除系列时自动清理相关数据
- **索引优化**: 针对常用查询优化性能
- **备份友好**: SQLite 文件可轻松备份

## 💡 应用场景

### 📖 英语学习
1. 处理英语听力材料生成字幕
2. 标记重点词汇和音标
3. 建立个人词汇库
4. 跨材料复习单词

### 🎬 内容创作
1. 批量处理视频/音频内容
2. 管理字幕资源
3. 为后续视频制作准备素材
4. 统计内容时长和数量

### 📚 资料整理
1. 将音视频转为可搜索的文本
2. 按时间轴组织内容
3. 快速定位特定内容
4. 建立知识库索引

## 🔧 技术特性

### 🏗️ 架构设计
- **模块化**: 数据库功能独立模块
- **事务安全**: 使用上下文管理器确保数据一致性
- **错误处理**: 完善的异常处理机制
- **日志记录**: 详细的操作日志

### ⚡ 性能优化
- **索引策略**: 针对时间查询和关键词搜索优化
- **批量操作**: 支持批量插入和更新
- **连接池**: 有效管理数据库连接
- **查询优化**: 使用适当的 JOIN 和聚合查询

### 🔒 数据安全
- **外键约束**: 保证数据引用完整性
- **级联删除**: 避免孤立数据
- **类型检查**: 严格的数据类型验证
- **备份支持**: 支持 SQLite 数据库备份

## 🚧 未来规划

### 🎯 短期目标
- [ ] 自动重点词汇提取
- [ ] 词汇难度评级
- [ ] 学习进度追踪
- [ ] 数据导出功能

### 🌟 长期愿景
- [ ] 词汇学习计划生成
- [ ] 多语言支持扩展
- [ ] 字幕烧制到视频
- [ ] 智能内容推荐

## 📞 技术支持

如有问题或建议，请：
1. 查看日志文件了解详细错误信息
2. 检查数据库文件 `data/englishcut.db`
3. 确保有足够的磁盘空间
4. 验证文件权限设置

---

**🎉 数据库功能让 EnglishCut 从简单的转录工具升级为完整的内容管理平台！** 